<% layout("/layouts/boilerplate") -%>


<style>
  #filters{
    margin-top: 1rem;
    display: flex;;
    flex-wrap: wrap;
    align-items: center;

  }
  .filter{
    text-align: center;
    margin-right: 2rem;
    margin-top: 1rem;
    opacity: 0.7;
  }
  .filter:hover{
    opacity: 1;
    cursor: pointer;
  }

  .filter p{
    font-size: 0.78rem;
  }
  #tax-info{
    display: none;
  }
  .tax-toggle {
    border: 1px solid #ccc;
    border-radius: 0.5rem;
    padding: 0.5rem 1rem;
    margin-left: 16rem;
    margin-top: 1rem;
    display: flex;
    align-items: center;
    background-color: #f9f9f9;
    transition: all 0.3s ease;
  }

  .tax-toggle:hover {
    border-color: #999;
    background-color: #fff;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }
</style>



<div id="filters">
  <div class="filter">
    <div><i class="fa-solid fa-fire"></i></div>
    <p>Trending</p>

  </div>

  <div class="filter">
    <div><i class="fa-solid fa-bed"></i></div>
    <p>Rooms</p>

  </div>

  <div class="filter">
    <div><i class="fa-solid fa-mountain-city"></i></div>
    <p>Iconic Cities</p>

  </div>

  <div class="filter">
    <div><i class="fa-solid fa-umbrella-beach"></i></div>
    <p>Beach</p>

  </div>

  <div class="filter">
    <div><i class="fa-brands fa-fort-awesome"></i></div>
    <p>Castles</p>

  </div>

  <div class="filter">
    <div><i class="fa-solid fa-water-ladder"></i></div>
    <p>Amazing pools</p>

  </div>

  <div class="filter">
    <div><i class="fa-solid fa-tent"></i></div>
    <p>Camping</p>

  </div>

  <div class="filter">
    <div><i class="fa-solid fa-money-bill-wheat"></i></div>
    <p>Farms</p>

  </div>

  <div class="filter">
    <div><i class="fa-brands fa-galactic-senate"></i></div>
    <p>Arctic</p>

  </div>

  <div class="filter">
    <div><i class="fa-brands fa-ship"></i></div>
    <p>Boats</p>

  </div>

  <div class="tax-toggle">
    <div class="form-check form-check reverse form-switch">
      <input class="form-check-input" type="checkbox" role="switch" id="switchCheckDefault">
      <label class="form-check-label" for="switchCheckDefault">DIsplay total after taxes</label>
  </div>

    

  </div>



</div>












































<body>
    <!-- Page Title -->
    <!-- <h3 class="all-listing">All listings</h3> -->

    <!-- Listings Grid -->
    <div class="row row-cols-lg-4 row-cols-md-3 row-cols-sm-3 mt-3" >

      <!-- Loop through all listings sent from route -->
      <% for (let listing of allListings) { %>

        <!-- Each listing card wrapped in a link to its show page -->
        <a href="/listings/<%= listing._id %>" class="listing-link">
          <div class="card col listing-card" style="width: 18rem;">

            <!-- Image Handling Logic -->
            <% 
              let imageSrc = '/images/placeholder.png'; // default image

              // If image is a string
              if (typeof listing.image === 'string') {
                imageSrc = listing.image.startsWith('http')
                  ? listing.image
                  : '/uploads/' + listing.image;

              // If image is an array
              } else if (Array.isArray(listing.image) && listing.image.length) {
                const img = listing.image[0];

                if (typeof img === 'string') {
                  imageSrc = img.startsWith('http') ? img : '/uploads/' + img;
                } else if (img?.filename) {
                  imageSrc = '/uploads/' + img.filename;
                } else if (img?.path) {
                  imageSrc = '/uploads/' + img.path.split(/[/\\]/).pop();
                }

              // If image is an object
              } else if (listing.image && typeof listing.image === 'object') {
                if (listing.image.url) imageSrc = listing.image.url;
                else if (listing.image.secure_url) imageSrc = listing.image.secure_url;
                else if (listing.image.filename) imageSrc = '/uploads/' + listing.image.filename;
                else if (listing.image.path) imageSrc = '/uploads/' + listing.image.path.split(/[/\\]/).pop();
              }
            %>

            <!-- Listing Image -->
            <img src="<%= imageSrc %>" class="card-img-top" alt="listing_image" style="height: 20rem;">

            <!-- Listing Info -->
            <div class="card-body">
              <p class="card-text">
                <b><%= listing.title %></b> <br>
                <!-- Price formatted as INR currency -->
                <%= listing.price.toLocaleString("en-IN", {
                      style: "currency",
                      currency: "INR"
                    }) %>/night
                    <i id="tax-info"> &nbsp;&+18% GST</i>
              </p>
            </div>

          </div>
        </a>

      <% } %> <!-- End of listings loop -->

    </div> <!-- End of listings grid -->

</body>


<script>
  let taxswtch = document.getElementById("switchCheckDefault")
  taxswtch.addEventListener("click",()=>{
  let taxinfo = document.getElementById("tax-info")
    const taxInfoElements = document.querySelectorAll("#tax-info");
    if(taxswtch.checked){
      taxInfoElements.forEach(el => el.style.display = "inline");
    } else {
      taxInfoElements.forEach(el => el.style.display = "none");
    }
    
  })
</script>
